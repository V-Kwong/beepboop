(this.webpackJsonpbeepboop=this.webpackJsonpbeepboop||[]).push([[0],{107:function(e,t,a){"use strict";a.r(t);var n=a(1),c=a.n(n),s=a(25),r=a.n(s),i=(a(31),a(3)),o=(a(32),a(7)),l=a(13),d=a.n(l),u=a(4),j=a.n(u),b=a(14),h=a.n(b);h.a.setLevel("ERROR");var O=h.a,f=a(0);function p(e){var t=Object(n.useContext)(M);return Object(f.jsx)("thead",{children:Object(f.jsxs)("tr",{children:[Object(f.jsx)("th",{children:Object(f.jsx)("div",{className:"section-header",children:Object(f.jsx)("div",{className:"section-header-title",children:Object(f.jsx)("h2",{children:e.title})})})}),t.dates.map((function(e){return Object(f.jsx)("th",{children:Object(f.jsxs)("div",{className:"date date-heading",children:[Object(f.jsx)("span",{children:e.format("ddd")}),Object(f.jsx)("span",{children:e.format("DD")})]})},e.toString())}))]})})}var m=a(26),x=a(16);function v(e){var t=Object(n.useContext)(M),a=new Map,c=e.habit,s=c.text,r=c.history;O.debug(s);var i,o=Object(m.a)(r);try{for(o.s();!(i=o.n()).done;){var l=i.value,d=j()(l.date).format(C);O.debug(JSON.stringify(l)),void 0!==l.scoredUp&&void 0!==l.scoredDown&&a.set(d,[l.scoredUp,l.scoredDown])}}catch(b){o.e(b)}finally{o.f()}var u=t.dates.map((function(e){return e.format(C)})).map((function(e){return{day:e,score:a.get(e)}}));return 0!==u.filter((function(e){return void 0!==e.score})).length||e.showNoHistory?Object(f.jsxs)("tr",{children:[Object(f.jsx)("td",{className:"task-name-row",children:Object(f.jsx)("span",{className:"task-name",dangerouslySetInnerHTML:{__html:x.render(s)}})}),u.map((function(e){var t=e.day,a=e.score;return a?Object(f.jsx)(y,{up:a[0],down:a[1]},t):Object(f.jsx)("td",{className:"habit-cell",children:"\xa0"},t)}))]}):null}function y(e){var t=e.up>=4?"success":"fail";return Object(f.jsx)("td",{className:"habit-cell",children:Object(f.jsx)("div",{className:"habit-score-container",children:e.up>0&&Object(f.jsx)("div",{className:[t,"center-wrapper"].join(" "),children:Object(f.jsxs)("span",{children:["+",e.up]})})})})}var N=a(16);function g(e){var t=Object(n.useState)(!0),a=Object(i.a)(t,2),c=a[0],s=a[1];return Object(f.jsxs)("section",{className:"dailys",children:[Object(f.jsxs)("table",{children:[Object(f.jsx)(p,{title:"Dailies",setShowNoHistory:s,showNoHistory:c}),Object(f.jsx)("tbody",{children:e.data.map((function(e){return"habit"===e.type?Object(f.jsx)(v,{showNoHistory:c,habit:e},e.id):Object(f.jsx)(w,{showNoHistory:c,daily:e},e.id)}))})]}),Object(f.jsx)("div",{className:"link show-no-history",onClick:function(){return s(!c)}})]})}function w(e){var t=Object(n.useContext)(M),a=new Map,c=e.daily,s=c.text,r=c.history;O.debug(s);for(var i=1;i<r.length;i++){var o=r[i].value-r[i-1].value,l=j()(r[i].date);if(O.debug(l.format("YYYY-MM-DD HH:mm:ss")+": "+r[i].value),0!==o){if(t.cronIntervals.search(l.unix(),l.unix()).length>0){var d=l.subtract(1,"day");a.has(d.format(C))?a.has(l.format(C))&&O.warn("Too many completions for ".concat(s," on ").concat(l)):l=d}var u=l.format(C);a.set(u,o)}}console.groupEnd();var b=t.dates.map((function(e){return e.format(C)})).map((function(e){return{day:e,delta:a.get(e)}}));return 0!==b.filter((function(e){return void 0!==e.delta})).length||e.showNoHistory?Object(f.jsxs)("tr",{children:[Object(f.jsx)("td",{className:"task-name-row",children:Object(f.jsx)("span",{className:"task-name",dangerouslySetInnerHTML:{__html:N.render(s)}})}),b.map((function(e){var t=e.day,a=e.delta;return Object(f.jsx)(E,{delta:a},t)}))]}):null}function E(e){var t,a=["daily-cell"];return e.delta&&0!==e.delta?e.delta>0?(a.push("success"),t="\u2713"):(a.push("fail"),t="\u2716"):(a.push("pass"),t="\xa0"),Object(f.jsx)("td",{className:a.join(" "),children:t&&Object(f.jsx)("div",{className:"center-wrapper",children:Object(f.jsx)("span",{className:"symbol",children:t})})})}var S="https://habitica.com/api/v3",R="/tasks/user",M=c.a.createContext({showTaskIcons:!1,dates:Array(),cronIntervals:new d.a});function T(e){var t=Object(n.useState)(!0),a=Object(i.a)(t,2),c=a[0],s=a[1],r=Object(n.useState)(!0),l=Object(i.a)(r,2),u=l[0],b=l[1],h=Object(n.useState)(!0),p=Object(i.a)(h,2),m=p[0],x=p[1],v=Object(n.useState)(7),y=Object(i.a)(v,2),N=y[0],w=y[1],E=Object(n.useState)(!1),T=Object(i.a)(E,2),D=T[0],C=T[1],I=Object(n.useState)([]),Y=Object(i.a)(I,2),_=Y[0],P=Y[1],H=Object(n.useState)([]),A=Object(i.a)(H,2),U=A[0],L=A[1],F=Object(n.useState)([]),J=Object(i.a)(F,2),K=J[0],B=J[1],W=Object(n.useState)([]),G=Object(i.a)(W,2),$=(G[0],G[1]),q=e.userId,z=e.userApiKey,Q=function(e){return fetch(e,{method:"GET",headers:{"Content-Type":"application/json","x-api-user":q,"x-api-key":z,"x-client":"0d9428fd-d6fa-45f3-a4db-f130e3ef10ea-HabiticaTracker"}})},V=function(e){if(!e.success)throw new Error(e.message);return e},X=e.setError;if(Object(n.useEffect)((function(){Q(S+"/user").then((function(e){return e.json()})).then(V).then((function(e){P(e.data.history.exp.map((function(e){var t=j()(e.date);return[t.unix()-300,t.unix()+300]}))),s(!1)}),(function(e){X(e)}))}),[]),Object(n.useEffect)((function(){Q(S+R).then((function(e){return e.json()})).then(V).then((function(e){L(e.data.filter((function(e){return"habit"===e.type}))),B(e.data.filter((function(e){return"daily"===e.type}))),b(!1),console.log(S+R,JSON.stringify(e))}),(function(e){X(e)}))}),[]),Object(n.useEffect)((function(){Q(S+"/tasks/user?type=completedTodos").then((function(e){return e.json()})).then(V).then((function(e){$(e.data.filter((function(e){return"todo"===e.type}))),x(!1)}),(function(e){X(e)}))}),[]),c||u||m)return Object(f.jsx)("div",{className:"App",children:Object(f.jsx)("p",{children:"Loading..."})});var Z=new d.a;_.forEach((function(e){O.debug("cron: ".concat(j.a.unix(e[0])," - ").concat(j.a.unix(e[1]))),Z.insert(e[0],e[1],!0)}));var ee,te={showTaskIcons:D,dates:(ee=N,Array(ee).fill(0).map((function(e,t){return t})).reverse().map((function(e){return j()().subtract(e,"day").startOf("day")}))),cronIntervals:Z};return Object(f.jsx)("div",{className:"App",children:Object(f.jsxs)(M.Provider,{value:te,children:[Object(f.jsx)(k,{numDaysToShow:N,setNumDaysToShow:w,toggleTaskIcons:function(){return C(!D)}}),Object(f.jsx)("div",{className:"identity",children:Object(f.jsx)("span",{children:"Ambitious \u2666 Mindful \u2666 Disciplined"})}),Object(f.jsx)(g,{data:[].concat(Object(o.a)(K.slice(0,-1)),Object(o.a)(U),Object(o.a)(K.slice(-1)))})]})})}function k(e){var t=function(){window.open("https://habitica.com/")},a=function(e){var t=e[0],a=e[e.length-1];if(t.month()===a.month())return a.format("MMMM YYYY");var n=t.year()===a.year()?"MMM":"MMM YYYY",c="MMM YYYY";return[t.format(n),a.format(c)].join("\u2013")}(Object(n.useContext)(M).dates);return Object(f.jsxs)("div",{className:"app-controls",children:[Object(f.jsx)("div",{className:"date-header",onClick:t,children:a}),Object(f.jsx)("div",{className:"date-header",onClick:t,children:"Habitica"})]})}var D,C="YYYYMMDD";!function(e){e[e.PROMPT_FOR_USER_CREDS=0]="PROMPT_FOR_USER_CREDS",e[e.USER_INPUT_ACCEPTED=1]="USER_INPUT_ACCEPTED",e[e.ERROR=2]="ERROR"}(D||(D={}));var I=function(){var e=Object(n.useState)("9ebcbcde-d6a2-40d6-9ec1-99de1e5e7470"),t=Object(i.a)(e,2),a=t[0],c=t[1],s=Object(n.useState)("82efbb68-ab5b-426a-bcad-da7fdc3273bb"),r=Object(i.a)(s,2),o=r[0],l=r[1],d=Object(n.useState)(),u=Object(i.a)(d,2),j=u[0],b=u[1],h=Object(n.useState)(D.USER_INPUT_ACCEPTED),O=Object(i.a)(h,2),p=O[0],m=O[1];return p===D.PROMPT_FOR_USER_CREDS||p===D.ERROR?Object(f.jsxs)("div",{className:"App",children:[Object(f.jsx)("h1",{children:"Habitica Tracker"}),j&&Object(f.jsxs)("div",{className:"error",children:["Error: ",j.message]}),Object(f.jsx)("p",{children:"This tool displays a history of your Habits, Dailies and Todos in Habitica."}),Object(f.jsxs)("p",{children:["Your User ID and API key can be found on the"," ",Object(f.jsx)("a",{href:"https://habitica.com/user/settings/api",target:"_blank",rel:"noopener noreferrer",children:"Settings > API"})," ","page in Habitica."]}),Object(f.jsxs)("form",{className:"user-api-form",children:[Object(f.jsxs)("div",{className:"label-container",children:[Object(f.jsx)("div",{className:"label",children:"User ID"}),Object(f.jsx)("input",{type:"text",className:"user-id",value:a,onChange:function(e){c(e.target.value)}})]}),Object(f.jsxs)("div",{className:"label-container",children:[Object(f.jsx)("span",{className:"label",children:"API Key"}),Object(f.jsx)("input",{type:"password",className:"api-key",value:o,onChange:function(e){l(e.target.value)},minLength:36})]}),Object(f.jsx)("div",{className:"submit-wrapper",children:Object(f.jsx)("input",{type:"submit",value:"Fetch My Data",onClick:function(e){e.preventDefault(),m(D.USER_INPUT_ACCEPTED)}})})]}),Object(f.jsx)("h2",{children:"Note"}),Object(f.jsxs)("ul",{children:[Object(f.jsx)("li",{children:"Your user ID and API key will be sent to the Habitica servers and nowhere else."}),Object(f.jsx)("li",{children:"This app does not change your Habitica account data. It only fetches and displays data."})]})]}):Object(f.jsx)(T,{userId:a,userApiKey:o,setError:function(e){b(e),m(D.ERROR)}})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(Object(f.jsx)(c.a.StrictMode,{children:Object(f.jsx)("div",{className:"app-wrapper",children:Object(f.jsx)(I,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},31:function(e,t,a){},32:function(e,t,a){}},[[107,1,2]]]);
//# sourceMappingURL=main.32afacf6.chunk.js.map