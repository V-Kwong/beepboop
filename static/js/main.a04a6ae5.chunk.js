(this.webpackJsonpbeepboop=this.webpackJsonpbeepboop||[]).push([[0],{105:function(e,t,n){},106:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n.n(a),c=n(23),r=n.n(c),o=(n(29),n(3)),i=(n(30),n(12)),d=n.n(i),l=n(4),j=n.n(l),u=n(13),b=n.n(u);b.a.setLevel("ERROR");var h=b.a,O=n(0);function f(e){var t=Object(a.useContext)(D);return Object(O.jsx)("thead",{children:Object(O.jsxs)("tr",{children:[Object(O.jsx)("th",{children:Object(O.jsx)("div",{className:"section-header",children:Object(O.jsx)("div",{className:"section-header-title",children:Object(O.jsx)("h2",{children:e.title})})})}),t.dates.map((function(e){return Object(O.jsx)("th",{children:Object(O.jsxs)("div",{className:"date date-heading",children:[Object(O.jsx)("span",{children:e.format("ddd")}),Object(O.jsx)("span",{children:e.format("DD")})]})},e.toString())}))]})})}var m=n(6);function p(e){var t=Object(a.useState)(!0),n=Object(o.a)(t,2),s=n[0],c=n[1];return Object(O.jsxs)("section",{className:"dailys",children:[Object(O.jsxs)("table",{children:[Object(O.jsx)(f,{title:"Dailies",setShowNoHistory:c,showNoHistory:s}),Object(O.jsx)("tbody",{children:e.data.map((function(e){return Object(O.jsx)(x,{showNoHistory:s,daily:e},e.id)}))})]}),Object(O.jsx)("div",{className:"link show-no-history",onClick:function(){return c(!s)}})]})}function x(e){var t=Object(a.useContext)(D),n=new Map,s=e.daily,c=s.text,r=s.history;h.debug(c);for(var o=1;o<r.length;o++){var i=r[o].value-r[o-1].value,d=j()(r[o].date);if(h.debug(d.format("YYYY-MM-DD HH:mm:ss")+": "+r[o].value),0!==i){if(t.cronIntervals.search(d.unix(),d.unix()).length>0){var l=d.subtract(1,"day");n.has(l.format(_))?n.has(d.format(_))&&h.warn("Too many completions for ".concat(c," on ").concat(d)):d=l}var u=d.format(_);n.set(u,i)}}console.groupEnd();var b=t.dates.map((function(e){return e.format(_)})).map((function(e){return{day:e,delta:n.get(e)}}));return 0!==b.filter((function(e){return void 0!==e.delta})).length||e.showNoHistory?Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{className:"task-name-row",children:Object(O.jsx)("span",{className:"task-name",dangerouslySetInnerHTML:{__html:m.render(c)}})}),b.map((function(e){var t=e.day,n=e.delta;return Object(O.jsx)(v,{delta:n},t)}))]}):null}function v(e){var t,n=["daily-cell"];return e.delta&&0!==e.delta?e.delta>0?(n.push("success"),t="\u2713"):(n.push("fail"),t="\u2716"):(n.push("pass"),t="\xa0"),Object(O.jsx)("td",{className:n.join(" "),children:t&&Object(O.jsx)("div",{className:"center-wrapper",children:Object(O.jsx)("span",{className:"symbol",children:t})})})}var y=n(24),N=n(6);function w(e){var t=Object(a.useState)(!0),n=Object(o.a)(t,2),s=n[0],c=n[1];return Object(O.jsx)("section",{className:"habits",children:Object(O.jsxs)("table",{children:[Object(O.jsx)(f,{title:"Habits",setShowNoHistory:c,showNoHistory:s}),Object(O.jsx)("tbody",{children:e.data.map((function(e){return Object(O.jsx)(S,{showNoHistory:s,habit:e},e.id)}))})]})})}function S(e){var t=Object(a.useContext)(D),n=new Map,s=e.habit,c=s.text,r=s.history;h.debug(c);var o,i=Object(y.a)(r);try{for(i.s();!(o=i.n()).done;){var d=o.value,l=j()(d.date).format(_);h.debug(JSON.stringify(d)),void 0!==d.scoredUp&&void 0!==d.scoredDown&&n.set(l,[d.scoredUp,d.scoredDown])}}catch(b){i.e(b)}finally{i.f()}var u=t.dates.map((function(e){return e.format(_)})).map((function(e){return{day:e,score:n.get(e)}}));return 0!==u.filter((function(e){return void 0!==e.score})).length||e.showNoHistory?Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{className:"task-name-row",children:Object(O.jsx)("span",{className:"task-name",dangerouslySetInnerHTML:{__html:N.render(c)}})}),u.map((function(e){var t=e.day,n=e.score;return n?Object(O.jsx)(g,{up:n[0],down:n[1]},t):Object(O.jsx)("td",{className:"habit-cell",children:"\xa0"},t)}))]}):null}function g(e){return Object(O.jsx)("td",{className:"habit-cell",children:Object(O.jsxs)("div",{className:"habit-score-container",children:[e.up>0&&Object(O.jsx)("div",{className:"success center-wrapper",children:Object(O.jsxs)("span",{children:["+",e.up]})}),e.down>0&&Object(O.jsx)("div",{className:"fail center-wrapper",children:Object(O.jsxs)("span",{children:["-",e.down]})})]})})}n(105);var E=n(6);function T(e){var t=Object(a.useContext)(D).dates[0],n=e.data.filter((function(e){return j()(e.dateCompleted).isAfter(t)}));return Object(O.jsxs)("section",{className:"todos",children:[Object(O.jsx)("h2",{children:"Completed Todos"}),Object(O.jsx)("ul",{children:n.map((function(e){return Object(O.jsx)(R,{todo:e},e.id)}))})]})}function R(e){var t=j()(e.todo.dateCompleted).format("MMM D");return Object(O.jsxs)("li",{className:"todo-row",children:[Object(O.jsx)("span",{className:"todo-date date",children:t}),Object(O.jsx)("div",{className:"task-name",dangerouslySetInnerHTML:{__html:E.render(e.todo.text)}})]})}var k="https://habitica.com/api/v3",D=s.a.createContext({showTaskIcons:!1,dates:Array(),cronIntervals:new d.a});function M(e){var t=Object(a.useState)(!0),n=Object(o.a)(t,2),s=n[0],c=n[1],r=Object(a.useState)(!0),i=Object(o.a)(r,2),l=i[0],u=i[1],b=Object(a.useState)(!0),f=Object(o.a)(b,2),m=f[0],x=f[1],v=Object(a.useState)(7),y=Object(o.a)(v,2),N=y[0],S=y[1],g=Object(a.useState)(!1),E=Object(o.a)(g,2),R=E[0],M=E[1],I=Object(a.useState)([]),_=Object(o.a)(I,2),Y=_[0],H=_[1],P=Object(a.useState)([]),A=Object(o.a)(P,2),U=A[0],L=A[1],F=Object(a.useState)([]),J=Object(o.a)(F,2),K=J[0],B=J[1],W=Object(a.useState)([]),G=Object(o.a)(W,2),$=G[0],q=G[1],z=e.userId,Q=e.userApiKey,V=function(e){return fetch(e,{method:"GET",headers:{"Content-Type":"application/json","x-api-user":z,"x-api-key":Q,"x-client":"0d9428fd-d6fa-45f3-a4db-f130e3ef10ea-HabiticaTracker"}})},X=function(e){if(!e.success)throw new Error(e.message);return e},Z=e.setError;if(Object(a.useEffect)((function(){V(k+"/user").then((function(e){return e.json()})).then(X).then((function(e){H(e.data.history.exp.map((function(e){var t=j()(e.date);return[t.unix()-300,t.unix()+300]}))),c(!1)}),(function(e){Z(e)}))}),[]),Object(a.useEffect)((function(){V(k+"/tasks/user").then((function(e){return e.json()})).then(X).then((function(e){L(e.data.filter((function(e){return"habit"===e.type}))),B(e.data.filter((function(e){return"daily"===e.type}))),u(!1)}),(function(e){Z(e)}))}),[]),Object(a.useEffect)((function(){V(k+"/tasks/user?type=completedTodos").then((function(e){return e.json()})).then(X).then((function(e){q(e.data.filter((function(e){return"todo"===e.type}))),x(!1)}),(function(e){Z(e)}))}),[]),s||l||m)return Object(O.jsx)("div",{className:"App",children:Object(O.jsx)("p",{children:"Loading..."})});var ee=new d.a;Y.forEach((function(e){h.debug("cron: ".concat(j.a.unix(e[0])," - ").concat(j.a.unix(e[1]))),ee.insert(e[0],e[1],!0)}));var te,ne={showTaskIcons:R,dates:(te=N,Array(te).fill(0).map((function(e,t){return t})).reverse().map((function(e){return j()().subtract(e,"day").startOf("day")}))),cronIntervals:ee};return Object(O.jsx)("div",{className:"App",children:Object(O.jsxs)(D.Provider,{value:ne,children:[Object(O.jsx)(C,{numDaysToShow:N,setNumDaysToShow:S,toggleTaskIcons:function(){return M(!R)}}),Object(O.jsx)(w,{data:U}),Object(O.jsx)(p,{data:K}),Object(O.jsx)(T,{data:$})]})})}function C(e){var t=function(e){var t=e[0],n=e[e.length-1];if(t.month()===n.month())return n.format("MMMM YYYY");var a=t.year()===n.year()?"MMM":"MMM YYYY",s="MMM YYYY";return[t.format(a),n.format(s)].join("\u2013")}(Object(a.useContext)(D).dates);return Object(O.jsxs)("div",{className:"app-controls",children:[Object(O.jsx)("div",{className:"date-header",children:t}),Object(O.jsxs)("div",{children:[Object(O.jsx)("span",{role:"button",className:"link",onClick:function(){return e.setNumDaysToShow(e.numDaysToShow+7)},children:"+1 week"}),e.numDaysToShow>7?Object(O.jsxs)("span",{children:[Object(O.jsx)("span",{children:" / "}),Object(O.jsx)("span",{role:"button",className:"link",onClick:function(){return e.setNumDaysToShow(e.numDaysToShow-7)},children:"-1 week"})]}):null]})]})}var I,_="YYYYMMDD";!function(e){e[e.PROMPT_FOR_USER_CREDS=0]="PROMPT_FOR_USER_CREDS",e[e.USER_INPUT_ACCEPTED=1]="USER_INPUT_ACCEPTED",e[e.ERROR=2]="ERROR"}(I||(I={}));var Y=function(){var e=Object(a.useState)("9ebcbcde-d6a2-40d6-9ec1-99de1e5e7470"),t=Object(o.a)(e,2),n=t[0],s=t[1],c=Object(a.useState)("82efbb68-ab5b-426a-bcad-da7fdc3273bb"),r=Object(o.a)(c,2),i=r[0],d=r[1],l=Object(a.useState)(),j=Object(o.a)(l,2),u=j[0],b=j[1],h=Object(a.useState)(I.USER_INPUT_ACCEPTED),f=Object(o.a)(h,2),m=f[0],p=f[1];return m===I.PROMPT_FOR_USER_CREDS||m===I.ERROR?Object(O.jsxs)("div",{className:"App",children:[Object(O.jsx)("h1",{children:"Habitica Tracker"}),u&&Object(O.jsxs)("div",{className:"error",children:["Error: ",u.message]}),Object(O.jsx)("p",{children:"This tool displays a history of your Habits, Dailies and Todos in Habitica."}),Object(O.jsxs)("p",{children:["Your User ID and API key can be found on the"," ",Object(O.jsx)("a",{href:"https://habitica.com/user/settings/api",target:"_blank",rel:"noopener noreferrer",children:"Settings > API"})," ","page in Habitica."]}),Object(O.jsxs)("form",{className:"user-api-form",children:[Object(O.jsxs)("div",{className:"label-container",children:[Object(O.jsx)("div",{className:"label",children:"User ID"}),Object(O.jsx)("input",{type:"text",className:"user-id",value:n,onChange:function(e){s(e.target.value)}})]}),Object(O.jsxs)("div",{className:"label-container",children:[Object(O.jsx)("span",{className:"label",children:"API Key"}),Object(O.jsx)("input",{type:"password",className:"api-key",value:i,onChange:function(e){d(e.target.value)},minLength:36})]}),Object(O.jsx)("div",{className:"submit-wrapper",children:Object(O.jsx)("input",{type:"submit",value:"Fetch My Data",onClick:function(e){e.preventDefault(),p(I.USER_INPUT_ACCEPTED)}})})]}),Object(O.jsx)("h2",{children:"Note"}),Object(O.jsxs)("ul",{children:[Object(O.jsx)("li",{children:"Your user ID and API key will be sent to the Habitica servers and nowhere else."}),Object(O.jsx)("li",{children:"This app does not change your Habitica account data. It only fetches and displays data."})]})]}):Object(O.jsx)(M,{userId:n,userApiKey:i,setError:function(e){b(e),p(I.ERROR)}})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(Object(O.jsx)(s.a.StrictMode,{children:Object(O.jsx)("div",{className:"app-wrapper",children:Object(O.jsx)(Y,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},29:function(e,t,n){},30:function(e,t,n){}},[[106,1,2]]]);
//# sourceMappingURL=main.a04a6ae5.chunk.js.map