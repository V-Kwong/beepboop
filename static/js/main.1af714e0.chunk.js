(this.webpackJsonpbeepboop=this.webpackJsonpbeepboop||[]).push([[0],{107:function(e,t,a){"use strict";a.r(t);var n=a(1),c=a.n(n),s=a(25),r=a.n(s),i=(a(31),a(3)),o=(a(32),a(7)),d=a(13),l=a.n(d),u=a(4),j=a.n(u),b=a(14),h=a.n(b);h.a.setLevel("ERROR");var f=h.a,O=a(0);function p(e){var t=Object(n.useContext)(T);return Object(O.jsx)("thead",{children:Object(O.jsxs)("tr",{children:[Object(O.jsx)("th",{children:Object(O.jsx)("div",{className:"section-header",children:Object(O.jsx)("div",{className:"section-header-title",children:Object(O.jsx)("h2",{children:e.title})})})}),t.dates.map((function(e){return Object(O.jsx)("th",{children:Object(O.jsxs)("div",{className:"date date-heading",children:[Object(O.jsx)("span",{children:e.format("ddd")}),Object(O.jsx)("span",{children:e.format("DD")})]})},e.toString())}))]})})}var m=a(26),x=a(16);function v(e){var t=Object(n.useContext)(T),a=new Map,c=e.habit,s=c.text,r=c.history;f.debug(s);var i,o=Object(m.a)(r);try{for(o.s();!(i=o.n()).done;){var d=i.value,l=j()(d.date).format(I);f.debug(JSON.stringify(d)),void 0!==d.scoredUp&&void 0!==d.scoredDown&&a.set(l,[d.scoredUp,d.scoredDown])}}catch(b){o.e(b)}finally{o.f()}var u=t.dates.map((function(e){return e.format(I)})).map((function(e){return{day:e,score:a.get(e)}}));return 0!==u.filter((function(e){return void 0!==e.score})).length||e.showNoHistory?Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{className:"task-name-row",children:Object(O.jsx)("span",{className:"task-name",dangerouslySetInnerHTML:{__html:x.render(s)}})}),u.map((function(e){var t=e.day,a=e.score;return a?Object(O.jsx)(y,{up:a[0],down:a[1]},t):Object(O.jsx)("td",{className:"habit-cell",children:"\xa0"},t)}))]}):null}function y(e){var t=e.up>=4?"success":"fail";return Object(O.jsx)("td",{className:"habit-cell",children:Object(O.jsx)("div",{className:"habit-score-container",children:e.up>0?Object(O.jsx)("div",{className:[t,"center-wrapper"].join(" "),children:Object(O.jsxs)("span",{children:["+",e.up]})}):Object(O.jsx)("div",{className:"fail center-wrapper",children:Object(O.jsx)("span",{children:e.up})})})})}var N=a(16);function g(e){var t=Object(n.useState)(!0),a=Object(i.a)(t,2),c=a[0],s=a[1];return Object(O.jsxs)("section",{className:"dailys",children:[Object(O.jsxs)("table",{children:[Object(O.jsx)(p,{title:"Dailies",setShowNoHistory:s,showNoHistory:c}),Object(O.jsx)("tbody",{children:e.data.map((function(e){return"habit"===e.type?Object(O.jsx)(v,{showNoHistory:c,habit:e},e.id):Object(O.jsx)(w,{showNoHistory:c,daily:e},e.id)}))})]}),Object(O.jsx)("div",{className:"link show-no-history",onClick:function(){return s(!c)}})]})}function w(e){var t=Object(n.useContext)(T),a=new Map,c=e.daily,s=c.text,r=c.history;f.debug(s);for(var i=1;i<r.length;i++){var o=r[i].value-r[i-1].value,d=j()(r[i].date);if(f.debug(d.format("YYYY-MM-DD HH:mm:ss")+": "+r[i].value),0!==o){if(t.cronIntervals.search(d.unix(),d.unix()).length>0){var l=d.subtract(1,"day");a.has(l.format(I))?a.has(d.format(I))&&f.warn("Too many completions for ".concat(s," on ").concat(d)):d=l}var u=d.format(I);a.set(u,o)}}console.groupEnd();var b=t.dates.map((function(e){return e.format(I)})).map((function(e){return{day:e,delta:a.get(e)}}));return 0!==b.filter((function(e){return void 0!==e.delta})).length||e.showNoHistory?Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{className:"task-name-row",children:Object(O.jsx)("span",{className:"task-name",dangerouslySetInnerHTML:{__html:N.render(s)}})}),b.map((function(e){var t=e.day,a=e.delta;return Object(O.jsx)(S,{delta:a},t)}))]}):null}function S(e){var t,a=["daily-cell"];return e.delta&&0!==e.delta?e.delta>0?(a.push("success"),t="\u2713"):(a.push("fail"),t="\u2716"):(a.push("pass"),t="\xa0"),Object(O.jsx)("td",{className:a.join(" "),children:t&&Object(O.jsx)("div",{className:"center-wrapper",children:Object(O.jsx)("span",{className:"symbol",children:t})})})}var E="https://habitica.com/api/v3",R="0d9428fd-d6fa-45f3-a4db-f130e3ef10ea-HabiticaTracker",k="/tasks/user",T=c.a.createContext({showTaskIcons:!1,dates:Array(),cronIntervals:new l.a});function M(e){var t=Object(n.useState)(!0),a=Object(i.a)(t,2),c=a[0],s=a[1],r=Object(n.useState)(!0),d=Object(i.a)(r,2),u=d[0],b=d[1],h=Object(n.useState)(!0),p=Object(i.a)(h,2),m=p[0],x=p[1],v=Object(n.useState)(7),y=Object(i.a)(v,2),N=y[0],w=y[1],S=Object(n.useState)(!1),M=Object(i.a)(S,2),D=M[0],I=M[1],Y=Object(n.useState)([]),_=Object(i.a)(Y,2),P=_[0],H=_[1],A=Object(n.useState)([]),U=Object(i.a)(A,2),J=U[0],L=U[1],F=Object(n.useState)([]),K=Object(i.a)(F,2),B=K[0],W=K[1],G=Object(n.useState)([]),$=Object(i.a)(G,2),q=($[0],$[1]),z=e.userId,Q=e.userApiKey,V=function(e){return fetch(e,{method:"GET",headers:{"Content-Type":"application/json","x-api-user":z,"x-api-key":Q,"x-client":R}})},X=function(e){if(!e.success)throw new Error(e.message);return e},Z=e.setError,ee=function(){return V(E+k).then((function(e){return e.json()})).then(X).then((function(e){L(e.data.filter((function(e){return"habit"===e.type}))),W(e.data.filter((function(e){return"daily"===e.type}))),b(!1),console.log(E+k,JSON.stringify(e.data.filter((function(e){return"habit"===e.type}))))}),(function(e){Z(e)}))};if(Object(n.useEffect)((function(){V(E+"/user").then((function(e){return e.json()})).then(X).then((function(e){H(e.data.history.exp.map((function(e){var t=j()(e.date);return[t.unix()-300,t.unix()+300]}))),s(!1)}),(function(e){Z(e)}))}),[]),Object(n.useEffect)((function(){ee()}),[]),Object(n.useEffect)((function(){V(E+"/tasks/user?type=completedTodos").then((function(e){return e.json()})).then(X).then((function(e){q(e.data.filter((function(e){return"todo"===e.type}))),x(!1)}),(function(e){Z(e)}))}),[]),c||u||m)return Object(O.jsx)("div",{className:"App",children:Object(O.jsx)("p",{children:"Loading..."})});var te=new l.a;P.forEach((function(e){f.debug("cron: ".concat(j.a.unix(e[0])," - ").concat(j.a.unix(e[1]))),te.insert(e[0],e[1],!0)}));var ae,ne={showTaskIcons:D,dates:(ae=N,Array(ae).fill(0).map((function(e,t){return t})).reverse().map((function(e){return j()().subtract(e,"day").startOf("day")}))),cronIntervals:te};return Object(O.jsx)("div",{className:"App",children:Object(O.jsxs)(T.Provider,{value:ne,children:[Object(O.jsx)(C,{numDaysToShow:N,setNumDaysToShow:w,toggleTaskIcons:function(){return I(!D)}}),Object(O.jsx)("div",{className:"identity",children:Object(O.jsx)("span",{children:"Ambitious \u2666 Mindful \u2666 Disciplined"})}),Object(O.jsx)(g,{data:[].concat(Object(o.a)(B.slice(0,-1)),Object(o.a)(J),Object(o.a)(B.slice(-1)))}),Object(O.jsx)("div",{className:"date-header",onClick:function(){return fetch(E+"/tasks/30c753a4-c306-475d-8c2a-464fda9fbaa3/score/up",{method:"POST",headers:{"Content-Type":"application/json","x-api-user":z,"x-api-key":Q,"x-client":R}}).then((function(e){return e.json()})).then(X).then((function(e){console.log(E+"/tasks/30c753a4-c306-475d-8c2a-464fda9fbaa3/score/up",JSON.stringify(e))}),(function(e){Z(e)})).then(ee)},children:"+ Score Pomodoro"})]})})}function C(e){var t=function(){window.open("https://habitica.com/")},a=function(e){var t=e[0],a=e[e.length-1];if(t.month()===a.month())return a.format("MMMM YYYY");var n=t.year()===a.year()?"MMM":"MMM YYYY",c="MMM YYYY";return[t.format(n),a.format(c)].join("\u2013")}(Object(n.useContext)(T).dates);return Object(O.jsxs)("div",{className:"app-controls",children:[Object(O.jsx)("div",{className:"date-header",onClick:t,children:a}),Object(O.jsx)("div",{className:"date-header",onClick:t,children:"Habitica"})]})}var D,I="YYYYMMDD";!function(e){e[e.PROMPT_FOR_USER_CREDS=0]="PROMPT_FOR_USER_CREDS",e[e.USER_INPUT_ACCEPTED=1]="USER_INPUT_ACCEPTED",e[e.ERROR=2]="ERROR"}(D||(D={}));var Y=function(){var e=Object(n.useState)("9ebcbcde-d6a2-40d6-9ec1-99de1e5e7470"),t=Object(i.a)(e,2),a=t[0],c=t[1],s=Object(n.useState)("82efbb68-ab5b-426a-bcad-da7fdc3273bb"),r=Object(i.a)(s,2),o=r[0],d=r[1],l=Object(n.useState)(),u=Object(i.a)(l,2),j=u[0],b=u[1],h=Object(n.useState)(D.USER_INPUT_ACCEPTED),f=Object(i.a)(h,2),p=f[0],m=f[1];return p===D.PROMPT_FOR_USER_CREDS||p===D.ERROR?Object(O.jsxs)("div",{className:"App",children:[Object(O.jsx)("h1",{children:"Habitica Tracker"}),j&&Object(O.jsxs)("div",{className:"error",children:["Error: ",j.message]}),Object(O.jsx)("p",{children:"This tool displays a history of your Habits, Dailies and Todos in Habitica."}),Object(O.jsxs)("p",{children:["Your User ID and API key can be found on the"," ",Object(O.jsx)("a",{href:"https://habitica.com/user/settings/api",target:"_blank",rel:"noopener noreferrer",children:"Settings > API"})," ","page in Habitica."]}),Object(O.jsxs)("form",{className:"user-api-form",children:[Object(O.jsxs)("div",{className:"label-container",children:[Object(O.jsx)("div",{className:"label",children:"User ID"}),Object(O.jsx)("input",{type:"text",className:"user-id",value:a,onChange:function(e){c(e.target.value)}})]}),Object(O.jsxs)("div",{className:"label-container",children:[Object(O.jsx)("span",{className:"label",children:"API Key"}),Object(O.jsx)("input",{type:"password",className:"api-key",value:o,onChange:function(e){d(e.target.value)},minLength:36})]}),Object(O.jsx)("div",{className:"submit-wrapper",children:Object(O.jsx)("input",{type:"submit",value:"Fetch My Data",onClick:function(e){e.preventDefault(),m(D.USER_INPUT_ACCEPTED)}})})]}),Object(O.jsx)("h2",{children:"Note"}),Object(O.jsxs)("ul",{children:[Object(O.jsx)("li",{children:"Your user ID and API key will be sent to the Habitica servers and nowhere else."}),Object(O.jsx)("li",{children:"This app does not change your Habitica account data. It only fetches and displays data."})]})]}):Object(O.jsx)(M,{userId:a,userApiKey:o,setError:function(e){b(e),m(D.ERROR)}})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(Object(O.jsx)(c.a.StrictMode,{children:Object(O.jsx)("div",{className:"app-wrapper",children:Object(O.jsx)(Y,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},31:function(e,t,a){},32:function(e,t,a){}},[[107,1,2]]]);
//# sourceMappingURL=main.1af714e0.chunk.js.map